<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mes serveurs ‚Äî Project : Delta</title>
  <link rel="icon" href="/assets/delta-icon.png" type="image/png" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .grayscale {
      filter: grayscale(100%);
      opacity: 0.5;
    }
@keyframes float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-4px);
  }
}

.avatar-float {
  animation: float 3s ease-in-out infinite;
}

  </style>
  <script defer src="serveurs.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white min-h-screen">

  <!-- Navigation -->
  <nav class="bg-gray-900 border-b border-gray-800 px-6 py-4 flex items-center justify-between fixed top-0 left-0 right-0 z-40 shadow-md">
    <div class="text-2xl font-bold text-indigo-400 animate-pulse">Project : Delta</div>
    <ul class="hidden md:flex space-x-6 text-sm font-medium text-gray-300">
      <li><a href="/" class="hover:text-indigo-400 transition">Accueil</a></li>
      <li><a href="/dashboard.html" class="hover:text-indigo-400 transition">Dashboard</a></li>
      <li><a href="/support.html" class="hover:text-indigo-400 transition">Support</a></li>
    </ul>
  </nav>

  <!-- Contenu principal -->
  <main class="pt-32 px-6 pb-12 max-w-6xl mx-auto">
    <h1 class="text-4xl font-extrabold mb-10 text-center text-indigo-300">Vos serveurs</h1>
    <div id="user-info" class="text-center mb-8"></div>
    <div id="guilds" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></div>
  </main>

<footer class="bg-gray-900 border-t border-gray-700 mt-auto animate-fade-in px-6 pt-12 pb-8 text-sm text-gray-400">
  <div class="max-w-6xl mx-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-10">
  
    <!-- Branding -->
    <div>
      <h3 class="font-semibold text-white text-base mb-3">Project : Delta</h3>
      <p class="text-gray-500 leading-relaxed">
        Un bot Discord de gestion complet, puissant et personnalisable, lanc√© en 2024.
      </p>
    </div>
  
    <!-- Navigation -->
    <div>
      <h3 class="font-semibold text-white text-base mb-3">Navigation</h3>
      <ul class="space-y-2">
        <li><a href="./index.html" class="hover:text-indigo-400 transition-colors duration-200">Accueil</a></li>
        <li><a href="./fonctionnalites.html" class="hover:text-indigo-400 transition-colors duration-200">Fonctionnalit√©s</a></li>
        <li><a href="./equipe.html" class="hover:text-indigo-400 transition-colors duration-200">√âquipe</a></li>
      </ul>
    </div>

    <!-- Documentation -->
    <div>
      <h3 class="font-semibold text-white text-base mb-3">Documentation</h3>
      <ul class="space-y-2">
        <li><a href="./support.html" class="hover:text-indigo-400 transition-colors duration-200">Support</a></li>
        <li><a href="./docs/faq.html" class="hover:text-indigo-400 transition-colors duration-200">FAQ</a></li>
        <li><a href="./docs/premium.html" class="hover:text-indigo-400 transition-colors duration-200">Premium</a></li>
      </ul>
    </div>
  
    <!-- Legal -->
    <div>
      <h3 class="font-semibold text-white text-base mb-3">L√©gal</h3>
      <ul class="space-y-2">
        <li><a href="./mentions-legales.html" class="hover:text-indigo-400 transition-colors duration-200">Mentions l√©gales</a></li>
        <li><a href="./politique-confidentialite.html" class="hover:text-indigo-400 transition-colors duration-200">Politique de confidentialit√©</a></li>
        <li><a href="./cgu-cgv.html" class="hover:text-indigo-400 transition-colors duration-200">Conditions d'utilisation</a></li>
      </ul>
    </div>
  
    <!-- Contact & R√©seaux -->
    <div>
      <h3 class="font-semibold text-white text-base mb-3">Contact</h3>
      <p>
        <a href="" class="hover:text-indigo-400 transition-colors duration-200">
          contact.project.delta@gmail.com
        </a>
      </p>
      <div class="flex items-center space-x-4 mt-4">
        <a href="https://discord.gg/rWuWu8YyZA" target="_blank" aria-label="Serveur Discord" class="hover:scale-110 transform transition duration-300">
          <img src="https://i.pinimg.com/736x/5a/dc/86/5adc86fedf90debb35e5058c52d48879.jpg" alt="Discord" class="w-9 h-9 rounded-full shadow-md">
        </a>
        <a href="https://www.instagram.com/delta.projet/?next=%2F" target="_blank" aria-label="Page Instagram" class="hover:scale-110 transform transition duration-300">
          <img src="https://i.pinimg.com/736x/7e/76/7f/7e767fe360fe2a528c8feb3cd6a7ed19.jpg" alt="Instagram" class="w-9 h-9 rounded-full shadow-md">
        </a>
        <a href="https://x.com/Delta_Proj_Isey" target="_blank" aria-label="Profil Twitter" class="hover:scale-110 transform transition duration-300">
          <img src="https://i.pinimg.com/736x/cc/31/6f/cc316f97197528e5e26e613a93ab16a4.jpg" alt="X" class="w-9 h-9 rounded-full shadow-md">
        </a>
      </div>
    </div>
  </div>
  
  <!-- Bottom copyright -->
  <div class="max-w-6xl mx-auto mt-10 border-t border-gray-700 pt-4 text-center text-xs text-gray-500">
    ¬© 2025 <span class="font-medium text-white">Project : Delta</span>. Tous droits r√©serv√©s. <br class="sm:hidden" />
    Ce site n'est pas affili√© √† Discord Inc.
  </div>
</footer>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get("code");
  const returnedState = urlParams.get("state");
  const savedState = localStorage.getItem("oauth2_state");

  async function afficherInfosUtilisateur(user) {
    const container = document.getElementById("user-info");
    const avatarURL = user.avatar
      ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`
      : `https://cdn.discordapp.com/embed/avatars/${parseInt(user.discriminator) % 5}.png`;

    container.innerHTML = `
      <div class="flex items-center justify-center gap-4">
        <img src="${avatarURL}" alt="Avatar"
          class="w-16 h-16 rounded-full shadow-md avatar-float transition duration-300 hover:scale-110 ring-2 ring-indigo-400 object-cover">
        <p class="text-lg">
          Connect√© en tant que 
          <span class="font-bold bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 text-transparent bg-clip-text">
            ${user.username}
          </span>
        </p>
      </div>
    `;
  }

async function afficherGuilds(guilds) {
  const container = document.getElementById("guilds");

  // √âtape 1 : Ne garder que les serveurs o√π l'utilisateur est owner ou admin
  const filteredGuilds = guilds.filter(g => g.isOwner || g.hasAdminPerms);

  if (!filteredGuilds.length) {
    container.innerHTML = "<p>Aucun serveur o√π vous √™tes propri√©taire ou admin.</p>";
    return;
  }

  // √âtape 2 : Affichage avec distinction visuelle selon pr√©sence du bot
  filteredGuilds.forEach(g => {
    const div = document.createElement("div");
    const iconUrl = g.icon || 'https://cdn.discordapp.com/embed/avatars/0.png';

    const classes = `
      ${g.isInServer 
        ? 'bg-gray-800 hover:bg-gray-700 hover:scale-105' 
        : 'bg-gray-700 grayscale opacity-50 pointer-events-none cursor-not-allowed'}
      p-4 rounded-lg shadow-md hover:shadow-xl transform transition-all duration-300
    `;

    const badges = [];
    if (g.isOwner) badges.push('<span class="text-yellow-400">üëë Owner</span>');
    else if (g.hasAdminPerms) badges.push('<span class="text-green-400">üõ°Ô∏è Admin</span>');
    if (!g.isInServer) badges.push('<span class="text-red-400">üö´ Bot non pr√©sent</span>');

    div.className = classes;
    div.innerHTML = `
      <div class="group flex flex-col items-center text-center">
        <img src="${iconUrl}" alt="Icon" 
            class="w-16 h-16 rounded-full mb-4 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3 shadow-lg">
        <h3 class="text-xl font-semibold">${g.name}</h3>
        <p class="text-gray-400 mb-2">Membres : ${g.memberCount}</p>
        ${badges.length ? `<div class="space-x-2">${badges.join("")}</div>` : ""}
      </div>
    `;
    container.appendChild(div);
  });
}

  async function start() {
    const container = document.getElementById("user-info");
    container.innerHTML = `<p>Chargement...</p>`;

    if (code && returnedState === savedState) {
      try {
        const response = await fetch(`https://discord-oauth-6z2s.onrender.com/api/discord-oauth?code=${code}`);
        const data = await response.json();

        if (data.success) {
          localStorage.setItem("user", JSON.stringify(data.user));
          localStorage.removeItem("oauth2_state");
          window.history.replaceState({}, "", "serveur.html");
          await afficherInfosUtilisateur(data.user);
          await afficherGuilds(data.mutualGuilds);
        } else {
          container.innerHTML = `<p>Erreur d'authentification : ${data.error}</p>`;
        }
      } catch (err) {
        container.innerHTML = `<p>Erreur lors de la requ√™te.</p>`;
      }
    } else {
      if (code && returnedState !== savedState) {
        alert("√âtat de s√©curit√© invalide, possible tentative d'injection !");
        return;
      }

      const user = JSON.parse(localStorage.getItem("user"));
      if (user) {
        await afficherInfosUtilisateur(user);
      } else {
        container.innerHTML = `<p>Non connect√©. <a href="/" class="text-indigo-400 underline">Retour</a></p>`;
      }
    }
  }

  start();
</script>
</body>
</html>

